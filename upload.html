<!DOCTYPE html>
<html lang="en">

<head>
    <title>Box UI Elements</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>
    <!-- polyfill.io only loads the polyfills your browser needs -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=es6,Intl"></script>
    <script src="https://cdn01.boxcdn.net/platform/elements/7.2.0/en-US/uploader.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
        crossorigin="anonymous">

    <!-- Latest version of the explorer css for your locale -->
    <!-- <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/7.2.0/en-US/explorer.css" /> -->
    <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/8.6.0/en-US/explorer.css" />
    <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/elements/7.2.0/en-US/uploader.css" />
    <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/preview/1.58.3/en-US/preview.css" />
    <script>
        var ccnumber = '';
        var folderId = '';
        var accessToken = '';
        var urlParams = new URLSearchParams(window.location.search);
        var uploader = new Box.ContentUploader();
        accessToken = urlParams.get('accessToken');

        $(document).ready(function () {

            $("#uploader").show();

            $("#submitbutton").click(function () {
                $("#submissionform :input").prop("disabled", true);
                $('#modalMessage').text("Getting case Folder...");
                $('#myModal').modal('show');
                //See if the folder exists
                var settingsFolderGet = {
                    "async": true,
                    "crossDomain": true,
                    "url": "https://api.box.com/2.0/folders?parent_id=62907309318&path=" + $("#ccnumber_input").val(),
                    "method": "GET",
                    "headers": {
                        "Authorization": "Bearer " + accessToken
                    }
                }

                $.ajax(settingsFolderGet).done(function (response) {
                    if (response.entries.length == 0) {
                        var settings = {
                            "async": true,
                            "crossDomain": true,
                            "url": "https://api.box.com/2.0/folders",
                            "method": "POST",
                            "headers": {
                                "Authorization": "Bearer " + accessToken
                            },
                            "data": "{\"name\":\"" + $("#ccnumber_input").val() + "\", \"parent\": {\"id\": \"62907309318\"}}"
                        }

                        $.ajax(settings).done(function (response) {
                            console.log(response);
                            folderId = response.id;
                            $('#modalMessage').text("Case folder created:" + folderId);
                            $("#uploader").show();
                            $('#uploader').load('uploadcontrol.html');
                            $('#modalMessage').text("Please upload your files...");
                            setTimeout(function () { $('#myModal').modal('toggle'); }, 3000);
                        });
                    } else {
                        folderId = response.entries[0].id;
                        $('#modalMessage').text("Case folder found:" + folderId);
                        $("#uploader").show();
                        $('#uploader').load('uploadcontrol.html');
                        $('#modalMessage').text("Please upload your files...");
                        setTimeout(function () { $('#myModal').modal('toggle'); }, 3000);
                    }

                });




            });

            $("#previewlink").click(function () {

            });



        });
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        /* Style the header */
        header {
            background-color: rgb(51, 7, 248);
            padding: 5px;
            text-align: center;
            font-size: 12px;
            color: white;
        }

        /* Create two columns/boxes that floats next to each other */
        nav {
            float:left;
            width: 40vw;
            height: 80vh;
            /*only for demonstration, should be removed */

            background: rgb(255, 255, 255);
            padding: 20px;

        }

        /* Style the list inside the menu */
        nav ul {
            list-style-type: none;
            padding: 0;
        }

        article {
            float: left;
            padding: 20px;
            width: 60vw;
            background-color: rgb(255, 255, 255);
            height: 80vh;

            /* only for demonstration, should be removed */
        }

        /* Clear floats after the columns */
        section:after {
            content: "";
            display: table;
            clear: both;
        }

        /* Style the footer */
        footer {
            background-color: rgb(25, 0, 255);
            padding: 1px;
            text-align: center;
            color: white;
        }

        /* Responsive layout - makes the two columns/boxes stack on top of each other instead of next to each other, on small screens */
        @media (max-width: 600px) {

            nav,
            article {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>

<body>

    <header>
        <h2>Portal View Upload</h2>
    </header>

    <section>
        <nav>
            <form id="submissionform">
                <div class="form-group">
                    <label for="firstname" class="col-sm-2 col-form-label col-form-label-sm">Firstname</label>
                    <input type="text" class="form-control form-control-sm" id="firstname_input" placeholder="Firstname"
                        aria-describedby="firstnameHelpBlock">
                    <small id="firstnameHelpBlock" class="form-text text-muted">
                        Please provide your first name.
                    </small>
                </div>
                <div class="form-group"></div>
                <label for="lasttname" class="col-sm-2  col-form-label-sm">Lastname</label>
                <input type="text" class="form-control form-control-sm" id="lastname_input" placeholder="Lastname"
                    aria-describedby="lastnameHelpBlock">
                <small id="lastnameHelpBlock" class="form-text text-muted">
                    Please provide your last name.
                </small>
                </div>
                <div class="form-group">
                    <label for="address" class="col-sm-2 col-form-label col-form-label-sm">Address</label>
                    <textarea type="text" class="form-control form-control-sm" id="address_textarea" placeholder="Address"
                        aria-describedby="addressHelpBlock" rows="4"></textarea>
                    <small id="addressHelpBlock" class="form-text text-muted">
                        This is the address where you normally reside.
                    </small>
                </div>
                <div class="form-group">
                    <label for="ccnumber" class="col-sm-3 col-form-label col-form-label-sm">C&C Number</label>
                    <input type="text" class="form-control form-control-sm" id="ccnumber_input" placeholder="C&C Number"
                        aria-describedby="ccnumberHelpBlock" required>
                    <small id="ccnumberHelpBlock" class="form-text text-muted">
                        Please provide the C&C Number that was provided to you.
                    </small>
                </div>
                <button id="submitbutton" type="button" class="btn btn-outline-secondary">Create Case</button>
            </form>


            <!-- The Modal -->
            <div class="modal fade" id="myModal">
                <div class="modal-dialog">
                    <div class="modal-content">

                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">Progress</h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>

                        <!-- Modal body -->
                        <div class="modal-body" id="modalMessage">
                            Progress Status...
                        </div>


                    </div>
                </div>
            </div>
        </nav>




        <article id="uploader">
            <!--             <div class="uploader-container" style="height:100%; width:100%;"></div>

            <script src="https://cdn01.boxcdn.net/platform/elements/7.2.0/en-US/uploader.js"></script>
            <script>
                var uploader = new Box.ContentUploader();
                alert(folderId);
                uploader.show(folderId, "jOzg0R6jLZzGI5Gf9RjREMDHZEXJmV22", {
                    container: '.uploader-container'
                });
            </script> -->

        </article>


    </section>

    <footer>
        <p>Footer</p>
    </footer>

</body>

</html>